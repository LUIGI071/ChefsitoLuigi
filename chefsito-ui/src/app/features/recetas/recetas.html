<section class="recipes-page">
  <header class="recipes-hero">
    <div class="hero-text">
      <h1>Recetas Sugeridas</h1>
      <p>Basado en tus ingredientes ü•ì ü•¶</p>
    </div>

    <div class="hero-actions">
      <button class="btn ghost" routerLink="/despensa">
        üß∫ Ver despensa
      </button>
      <button class="btn ghost" (click)="cargarRecetas()">
        üîÑ Actualizar sugerencias
      </button>
    </div>
  </header>

  <div *ngIf="loading" class="status info">
    Generando recetas para ti...
  </div>

  <div *ngIf="error" class="status error">
    {{ error }}
  </div>

  <div
    *ngIf="!loading && !error && recetas.length === 0"
    class="status empty"
  >
    <p>De momento no hay recetas sugeridas.</p>
    <p>
      Aseg√∫rate de tener ingredientes en tu despensa y vuelve a intentarlo.
    </p>
  </div>

  <div
    *ngIf="!loading && !error && recetas.length > 0"
    class="recipes-filters"
  >
    <div class="filter-group">
      <span class="filter-group-label">Ordenar por:</span>
      <button
        type="button"
        class="filter-chip"
        [class.active]="sortMode === 'none'"
        (click)="onChangeSort('none')"
      >
        Relevancia
      </button>
      <button
        type="button"
        class="filter-chip"
        [class.active]="sortMode === 'timeAsc'"
        (click)="onChangeSort('timeAsc')"
      >
        Tiempo ‚Üë
      </button>
      <button
        type="button"
        class="filter-chip"
        [class.active]="sortMode === 'timeDesc'"
        (click)="onChangeSort('timeDesc')"
      >
        Tiempo ‚Üì
      </button>
    </div>

    <div class="filter-group">
      <span class="filter-group-label">Dificultad:</span>
      <button
        type="button"
        class="filter-chip"
        [class.active]="difficultyFilter === 'ALL'"
        (click)="onChangeDifficulty('ALL')"
      >
        Todas
      </button>
      <button
        type="button"
        class="filter-chip"
        [class.active]="difficultyFilter === 'EASY'"
        (click)="onChangeDifficulty('EASY')"
      >
        F√°cil
      </button>
      <button
        type="button"
        class="filter-chip"
        [class.active]="difficultyFilter === 'MEDIUM'"
        (click)="onChangeDifficulty('MEDIUM')"
      >
        Media
      </button>
      <button
        type="button"
        class="filter-chip"
        [class.active]="difficultyFilter === 'HARD'"
        (click)="onChangeDifficulty('HARD')"
      >
        Dif√≠cil
      </button>
    </div>
  </div>

  <section
    *ngIf="!loading && !error && recetas.length > 0"
    class="recipes-grid"
  >
    <article
      *ngFor="let r of getFilteredAndSortedRecipes()"
      class="recipe-card"
      (click)="verDetalles(r)"
    >
      <div class="recipe-content">
        <header class="recipe-header">
          <h2>{{ r.title }}</h2>

          <div class="recipe-tags">
            <span *ngIf="r.difficulty" class="tag">
              {{ r.difficulty }}
            </span>
            <span *ngIf="r.preparationTime !== null" class="tag">
              ‚è± {{ r.preparationTime }} min
            </span>
            <span *ngIf="r.category" class="tag">
              {{ r.category }}
            </span>
          </div>
        </header>

        <div
          class="allergy-warning"
          *ngIf="getAllergensForRecipe(r).length > 0"
        >
          <p>‚ö† Esta receta contiene al√©rgenos que has marcado:</p>
          <div class="allergy-chips">
            <span class="chip" *ngFor="let a of getAllergensForRecipe(r)">
              {{ a }}
            </span>
          </div>
        </div>

        <p class="recipe-description">
          {{ r.description }}
        </p>

        <div class="ingredients-row">
          <div class="ingredients-block">
            <h3>Ingredientes</h3>
            <ul>
              <li *ngFor="let ing of r.ingredients">{{ ing }}</li>
            </ul>
          </div>

          <div class="ingredients-block missing">
            <h3>Pasos</h3>
            <ul>
              <li *ngFor="let step of r.instructions">{{ step }}</li>
            </ul>
          </div>
        </div>
      </div>
    </article>
  </section>

  <!-- BACKDROP MODAL DETALLE -->
  <div
    class="recipe-modal-backdrop"
    *ngIf="selectedRecipe"
    (click)="cerrarDetalles()"
  ></div>

  <!-- MODAL DETALLE DE RECETA -->
  <section class="recipe-modal" *ngIf="selectedRecipe">
    <header class="recipe-modal-header">
      <div>
        <h2>{{ selectedRecipe?.title }}</h2>
        <p>{{ selectedRecipe?.description }}</p>
      </div>

      <div class="recipe-modal-meta">
        <span *ngIf="selectedRecipe?.preparationTime">
          ‚è± {{ selectedRecipe?.preparationTime }} min
        </span>
        <span *ngIf="selectedRecipe?.difficulty">
          ‚≠ê {{ selectedRecipe?.difficulty }}
        </span>
        <span *ngIf="selectedRecipe?.category">
          üçΩ {{ selectedRecipe?.category }}
        </span>
      </div>
    </header>

    <div class="recipe-modal-body">
      <div class="modal-column">
        <h3>Ingredientes</h3>
        <ul>
          <li *ngFor="let ing of selectedRecipe?.ingredients">
            {{ ing }}
          </li>
        </ul>
      </div>

      <div class="modal-column">
        <h3>Preparaci√≥n paso a paso</h3>
        <ol>
          <li *ngFor="let step of selectedRecipe?.instructions; let i = index">
            <strong>Paso {{ i + 1 }}:</strong> {{ step }}
          </li>
        </ol>
      </div>
    </div>

    <div class="recipe-modal-actions">
      <button class="btn ghost" type="button" (click)="cerrarDetalles()">
        Cerrar
      </button>
    </div>
  </section>
</section>
